<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>DonKingKong Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { margin:0; padding:0; background:#111; color:white; font-family:Arial; text-align:center; }
  #login-box, #game-box, #scoreboard { display:none; }
  input{ padding:10px; margin:6px; border-radius:5px; border:none; }
  button{ padding:10px 20px; border:none; border-radius:6px; background:#ffcc00; font-weight:bold; cursor:pointer; }
  canvas{ background:#222; display:block; margin:20px auto; border:3px solid #ffcc00; }
  table{ margin:20px auto; width:80%; border-collapse:collapse; }
  th, td{ padding:10px; border-bottom:1px solid #555; }
</style>
</head>
<body>

<h1>ğŸµ DonKingKong - Retro Arcade</h1>

<!-- -------------------------------------------- -->
<!-- ë¡œê·¸ì¸ í™”ë©´ -->
<!-- -------------------------------------------- -->
<div id="login-box">
  <h2>ë¡œê·¸ì¸ í›„ ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”</h2>
  <input id="playerName" type="text" placeholder="ì´ë¦„"><br>
  <input id="studentId" type="text" placeholder="í•™ë²ˆ"><br>
  <button onclick="login()">ê²Œì„ ì‹œì‘</button>
</div>

<!-- -------------------------------------------- -->
<!-- ê²Œì„ í™”ë©´ -->
<!-- -------------------------------------------- -->
<div id="game-box">
  <h2 id="welcome"></h2>
  <canvas id="gameCanvas" width="480" height="320"></canvas>
  <h3 id="score">ì ìˆ˜: 0</h3>
  <button onclick="endGame()">ê²Œì„ ì¢…ë£Œ</button>
</div>

<!-- -------------------------------------------- -->
<!-- ìˆœìœ„í‘œ -->
<!-- -------------------------------------------- -->
<div id="scoreboard">
  <h2>ğŸ† ì ìˆ˜ ìˆœìœ„í‘œ</h2>
  <table>
    <thead>
      <tr><th>ìˆœìœ„</th><th>ì´ë¦„</th><th>í•™ë²ˆ</th><th>ì ìˆ˜</th></tr>
    </thead>
    <tbody id="scoreTable"></tbody>
  </table>
  <button onclick="restart()">ë‹¤ì‹œ í•˜ê¸°</button>
</div>

<script type="module">
/* -----------------------------------------------------
   Firebase ì´ˆê¸°í™”
------------------------------------------------------ */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getDatabase, ref, push, set, onValue } 
  from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

// âš ï¸ ë°˜ë“œì‹œ ë³¸ì¸ Firebase ì„¤ì •ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”
const firebaseConfig = {
  apiKey: "AIzaSyAkN_zk93tx6ZXGtjOOo5PO44sIUbhlCqw",
  authDomain: "donkeykong-d1ec0.firebaseapp.com",
  databaseURL: "https://donkeykong-d1ec0-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "donkeykong-d1ec0",
  storageBucket: "donkeykong-d1ec0.firebasestorage.app",
  messagingSenderId: "997360333742",
  appId: "1:997360333742:web:b8705c376c665704758e3f",
  measurementId: "G-CYM5EQM9GL"
};

const app = initializeApp(firebaseConfig);
const db  = getDatabase(app);

/* -----------------------------------------------------
   ì „ì—­ ë³€ìˆ˜
------------------------------------------------------ */
let player = { name: "", id: "" };
let score = 0;
let gameLoop;
let ctx;

/* -----------------------------------------------------
   ë¡œê·¸ì¸
------------------------------------------------------ */
window.onload = () => {
  document.getElementById("login-box").style.display = "block";
};

window.login = () => {
  const name = document.getElementById("playerName").value.trim();
  const id   = document.getElementById("studentId").value.trim();
  if(!name || !id){
    alert("ì´ë¦„ê³¼ í•™ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”");
    return;
  }

  player.name = name;
  player.id   = id;

  document.getElementById("login-box").style.display = "none";
  document.getElementById("game-box").style.display  = "block";
  document.getElementById("welcome").innerText = `${name}ë‹˜, ê²Œì„ ì‹œì‘!`;

  startGame();
};

/* -----------------------------------------------------
   ê²Œì„ ë¡œì§ (ê°„ë‹¨í•œ DonkeyKong ìŠ¤íƒ€ì¼)
------------------------------------------------------ */
function startGame(){
  const canvas = document.getElementById("gameCanvas");
  ctx = canvas.getContext("2d");

  let playerX = 220;
  let playerY = 280;
  let barrelX = 0;
  let barrelY = 0;
  score = 0;

  document.addEventListener("keydown", e=>{
    if(e.key==="ArrowLeft")  playerX -= 10;
    if(e.key==="ArrowRight") playerX += 10;
  });

  gameLoop = setInterval(()=>{
    ctx.clearRect(0,0,480,320);

    // ë°°ëŸ´(ì¥ì• ë¬¼)
    ctx.fillStyle = "brown";
    ctx.fillRect(barrelX, barrelY, 20, 20);
    barrelY += 4;
    if(barrelY > 320){
      barrelY = 0;
      barrelX = Math.random()*460;
      score += 10;
      document.getElementById("score").innerText = "ì ìˆ˜: " + score;
    }

    // í”Œë ˆì´ì–´
    ctx.fillStyle = "yellow";
    ctx.fillRect(playerX, playerY, 20, 20);

    // ì¶©ëŒ ì²´í¬
    if(playerX < barrelX+20 && playerX+20>barrelX &&
       playerY < barrelY+20 && playerY+20>barrelY){
      endGame();
    }
  }, 30);
}

/* -----------------------------------------------------
   ê²Œì„ ì¢…ë£Œ
-------------------------
